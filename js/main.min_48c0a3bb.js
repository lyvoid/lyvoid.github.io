var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,a){function o(t){try{c(n.next(t))}catch(e){a(e)}}function s(t){try{c(n["throw"](t))}catch(e){a(e)}}function c(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(o,s)}c((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,a=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){c.label=r[1];break}if(6===r[0]&&c.label<o[1]){c.label=o[1],o=r;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(r);break}o[2]&&c.ops.pop(),c.trys.pop();continue}r=e.call(t,c)}catch(n){r=[6,n],a=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,a,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},L1ATTRNAME;!function(t){t.MAXHP="MAXHP",t.ATK="ATK",t.DEF="DEF",t.CRITP="CRITP",t.DODGEP="DODGEP",t.CRITT="CRITT"}(L1ATTRNAME||(L1ATTRNAME={}));var ColorDef;!function(t){t[t.DodgerBlue=2003199]="DodgerBlue",t[t.GhostWhite=16316671]="GhostWhite",t[t.Coral=16744272]="Coral",t[t.Tan=13808780]="Tan",t[t.AntiqueWhite=16444375]="AntiqueWhite",t[t.DarkOrange=16747520]="DarkOrange",t[t.LimeGreen=3329330]="LimeGreen",t[t.DarkRed=9109504]="DarkRed",t[t.White=16777215]="White",t[t.DarkGray=11119017]="DarkGray",t[t.DimGray=6908265]="DimGray"}(ColorDef||(ColorDef={}));var IScene=function(){function t(){this.isInitialed=!1}return t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.initial=function(){},t.prototype.releaseResource=function(){},t.prototype.defaultRelease=function(){egret.Tween.removeAllTweens(),LayerManager.Ins.clear(),MessageManager.Ins.clearListener()},t.prototype.release=function(){},t.prototype.update=function(){},t}();__reflect(IScene.prototype,"IScene");var L1CharAttr=function(){function t(t,e,r,n,i,a,o,s){this.maxHp=t,this.atk=e,this.def=r,this.range=n,this.critPoint=i,this.dodgePoint=a,this.critTime=o,this.posNum=s,this.moveSpeed=160,this.rotationSpeed=180,this.angerAdds=20}return t.ATTRNAMES=[L1ATTRNAME.MAXHP,L1ATTRNAME.ATK,L1ATTRNAME.DEF,L1ATTRNAME.CRITP,L1ATTRNAME.DODGEP,L1ATTRNAME.CRITT],t.MAXANGER=100,t.CHARMINDIS=60,t.MAXDODGEP=80,t}();__reflect(L1CharAttr.prototype,"L1CharAttr");var L1CharConfig=function(){function t(t,e,r,n,i,a){this.attr=t,this.skills=e,this.normalSkill=r,this.passiveSkills=n,this.name=i,this.portImageName=a}return t}();__reflect(L1CharConfig.prototype,"L1CharConfig");var L1BuffConfig=function(){function t(t,e,r,n,i,a,o,s,c,h,l,u){void 0===t&&(t=1e3),void 0===e&&(e=500),void 0===r&&(r=L1BuffType.ATTRCHANGE),void 0===n&&(n=L1BuffStatus.NORMAL),void 0===i&&(i=""),void 0===a&&(a={}),void 0===o&&(o={}),void 0===s&&(s=function(){}),void 0===c&&(c=function(){return!0}),void 0===h&&(h=!0),void 0===l&&(l=!0),void 0===u&&(u=1e3),this.canBeClear=h,this.isGood=l,this.condCd=u,this.duration=t,this.period=e,this.buffType=r,this.status=n,this.name=i,this.attrAddAbs=a,this.attrAddRatio=o,this.affectFunc=s,this.isAffect=c}return t}();__reflect(L1BuffConfig.prototype,"L1BuffConfig");var L1BuffType;!function(t){t[t.AFFECTPERIOD=0]="AFFECTPERIOD",t[t.AFFECTCOND=1]="AFFECTCOND",t[t.ATTRCHANGE=2]="ATTRCHANGE",t[t.STATUS=3]="STATUS"}(L1BuffType||(L1BuffType={}));var L1BuffStatus;!function(t){t[t.NORMAL=0]="NORMAL",t[t.DIZZ=1]="DIZZ",t[t.SLIENT=2]="SLIENT",t[t.L3=3]="L3",t[t.L4=4]="L4"}(L1BuffStatus||(L1BuffStatus={}));var L1CreationConfig=function(){function t(t,e,r,n,i,a,o,s,c,h,l){void 0===t&&(t=10),void 0===e&&(e=L1CrtnFlyType.FIX),void 0===r&&(r=L1CrTnAffectContType.ONECE),void 0===n&&(n=L1CrTnAffectTargetSetType.RANGE),void 0===i&&(i=L1CrtnAffectTargetCamp.OTHER),void 0===a&&(a=1e3),void 0===o&&(o=1e3),void 0===s&&(s=1e3),void 0===c&&(c=function(t,e){L1Harm.harm(e,t)}),void 0===h&&(h=.4),void 0===l&&(l=ColorDef.White),this.radius=10,this.flyType=L1CrtnFlyType.FIX,this.affectContType=L1CrTnAffectContType.ONECE,this.affectTargetSetType=L1CrTnAffectTargetSetType.RANGE,this.affectTargetCamp=L1CrtnAffectTargetCamp.OTHER,this.flySpeed=1e3,this.lifeTime=1e3,this.affectPeriod=1e3,this.alpha=.4,this.radius=t,this.flySpeed=a,this.flyType=e,this.affectContType=r,this.affectTargetSetType=n,this.affectTargetCamp=i,this.lifeTime=o,this.affectPeriod=s,this.affectFunc=c,this.alpha=h,this.color=l}return t}();__reflect(L1CreationConfig.prototype,"L1CreationConfig");var L1CrtnFlyType;!function(t){t[t.FIX=0]="FIX",t[t.POSITION=1]="POSITION",t[t.DIRECT=2]="DIRECT",t[t.CHAR=3]="CHAR"}(L1CrtnFlyType||(L1CrtnFlyType={}));var L1CrTnAffectContType;!function(t){t[t.CONTINUE=0]="CONTINUE",t[t.ONECE=1]="ONECE"}(L1CrTnAffectContType||(L1CrTnAffectContType={}));var L1CrTnAffectTargetSetType;!function(t){t[t.PRESET=0]="PRESET",t[t.RANGE=1]="RANGE"}(L1CrTnAffectTargetSetType||(L1CrTnAffectTargetSetType={}));var L1CrtnAffectTargetCamp;!function(t){t[t.SELF=0]="SELF",t[t.OTHER=1]="OTHER"}(L1CrtnAffectTargetCamp||(L1CrtnAffectTargetCamp={}));var L1HarmConfig=function(){function t(t){t?this.harmFunc=t:this.harmFunc=function(t,e){var r=L1Harm.isRandTrue(t.critPoint),n=L1Harm.isRandTrue(e.DODGE),i=0;if(!n){var a=r?t.critTime:1;i=t.atk*t.atk/(e.def+t.atk)*a}return[r,i]}}return t}();__reflect(L1HarmConfig.prototype,"L1HarmConfig");var L1SkillConfig=function(){function t(t,e,r,n){this.name=t,this.cdMs=e,this.timeLine=r,this.skillTargetFind=n}return t}();__reflect(L1SkillConfig.prototype,"L1SkillConfig");var L1BUFFCFGS={TEMPLATE:new L1BuffConfig(1e3,1e3,L1BuffType.ATTRCHANGE,L1BuffStatus.NORMAL,"",{},{},function(t,e){},function(t,e){return!0}),BUFF01:new L1BuffConfig(1e3,1e3,L1BuffType.ATTRCHANGE,L1BuffStatus.NORMAL,"攻击 +10",{ATK:10}),BUFF02:new L1BuffConfig(1e4,1e3,L1BuffType.AFFECTPERIOD,L1BuffStatus.NORMAL,"持续掉血",null,null,function(t,e){L1Harm.harm(e,[t],new L1HarmConfig(function(){return[!1,88]})),L1BuffManager.Ins.newBuff(L1BUFFCFGS.BUFF01,t,e)})},GameRoot=function(){function t(){this._initialed=!1}return Object.defineProperty(t,"GameStage",{get:function(){return t.Ins._gameStage},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Ins",{get:function(){return t._instance?t._instance:(t._instance=new t,t._instance)},enumerable:!0,configurable:!0}),t.prototype.init=function(t){UserData.initialData(),this._gameStage=t,MessageManager.Ins.initial(t),LayerManager.Ins.initial(),SceneManager.Ins.initial(),TimeScaleManager.Ins.initial(),this._initialed=!0,this._gameStage.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},t.prototype.update=function(){this._initialed&&TimeScaleManager.Ins.update()&&SceneManager.Ins.update()},t}();__reflect(GameRoot.prototype,"GameRoot");var LayerManager=function(){function t(){}return Object.defineProperty(t,"Ins",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.initial=function(){this.loadingUI=new LoadingUI,this.loadingUI.initial(),this.uiLayer=new eui.UILayer,this.gameLayer=new egret.DisplayObjectContainer,this.loadingUI.touchEnabled=!1,this.uiLayer.touchEnabled=!1,this.gameLayer.touchEnabled=!1,GameRoot.GameStage.addChild(this.gameLayer),GameRoot.GameStage.addChild(this.uiLayer),GameRoot.GameStage.addChild(this.loadingUI)},t.prototype.showLoadingUILayer=function(){this.loadingUI.clear(),this.loadingUI.visible=!0,this.loadingUI.touchEnabled=!0},t.prototype.hideLoadingUILayer=function(){this.loadingUI.visible=!1,this.loadingUI.touchEnabled=!1},t.prototype.clear=function(){this.gameLayer.removeChildren(),this.uiLayer.removeChildren()},t}();__reflect(LayerManager.prototype,"LayerManager");var MessageManager=function(t){function e(){var e=t.call(this)||this;return e._listenerList=[],e}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return null==this.instance&&(this.instance=new e),this.instance},enumerable:!0,configurable:!0}),e.prototype.initial=function(t){t.addChild(this)},e.prototype.sendMessage=function(t,e){void 0===e&&(e=null),this.dispatchEvent(new Message(e,t))},e.prototype.addEventListener=function(e,r,n){t.prototype.addEventListener.call(this,e,r,n),this._listenerList.push([e,r,n])},e.prototype.clearListener=function(){for(var t=0,e=this._listenerList;t<e.length;t++){var r=e[t],n=r[0],i=r[1],a=r[2];this.removeEventListener(n,i,a)}this._listenerList=[]},e}(egret.DisplayObject);__reflect(MessageManager.prototype,"MessageManager");var Message=function(t){function e(e,r,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var a=t.call(this,r,n,i)||this;return a.messageContent=e,a}return __extends(e,t),e}(egret.Event);__reflect(Message.prototype,"Message");var TimeScaleManager=function(){function t(){this._timeScale=1,this._frameCount=0,this._isFrame30Play=[];for(var t=0;30>t;t++)this._isFrame30Play[t]=!0}return Object.defineProperty(t.prototype,"TimeScale",{set:function(t){if(this._frameCount=0,t>1)return void(this._timeScale=1);this._timeScale=t;var e=Math.ceil(30-30*this._timeScale);this.set30PlayArray(e),console.log(this._isFrame30Play)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Ins",{get:function(){return t._instance?t._instance:(t._instance=new t,t._instance)},enumerable:!0,configurable:!0}),t.prototype.initial=function(){},t.prototype.set30PlayArray=function(t){var e=30-t,r=!1;t>e&&(r=!0,e=t,t=30-e);for(var n=e/t,i=n,a=0,o=0;30>o;o++)e>0?i>a?(this._isFrame30Play[o]=!0,a+=1,e-=1):(this._isFrame30Play[o]=!1,i+=n):this._isFrame30Play[o]=!1;r&&this.playBoolReverse()},t.prototype.playBoolReverse=function(){for(var t=0;30>t;t++)this._isFrame30Play[t]=!this._isFrame30Play[t]},t.prototype.update=function(){return this._timeScale<.034?!1:this._timeScale>.966?!0:(this._frameCount=this._frameCount+1,this._frameCount>=30&&(this._frameCount=0),this._isFrame30Play[this._frameCount])},t}();__reflect(TimeScaleManager.prototype,"TimeScaleManager");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,r){function n(n){e.call(r,n,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?n(i):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var MessageType;!function(t){t.L1CRTNDESTROYED="L1CRTNDESTROYED",t.L1BATTLEUIPORTTAP="L1BATTLEUIPORTTAP"}(MessageType||(MessageType={}));var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=Util.createColorBG(this.stage.stageWidth,this.stage.stageHeight),this.stage.addChild(t),[4,this.loadResource()];case 1:return e.sent(),GameRoot.Ins.init(this.stage),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,this.loadTheme()];case 2:return r.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return r.sent(),this.stage.removeChild(t),[3,5];case 4:return e=r.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,r){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e}(eui.UILayer);__reflect(Main.prototype,"Main");var SceneManager=function(){function t(){}return Object.defineProperty(t,"Ins",{get:function(){return t._instance?t._instance:(t._instance=new t,t._instance)},enumerable:!0,configurable:!0}),t.prototype.initial=function(){this.setScene(new StartScene)},t.prototype.setScene=function(t){LayerManager.Ins.showLoadingUILayer();var e=this.curScene;this.curScene=t,null!=e&&(e.defaultRelease(),e.release(),e.releaseResource(),e=null),this.loadScene(t)},t.prototype.loadScene=function(t){var e=this;t.loadResource().then(function(){t.initial(),t.isInitialed=!0,e.onSceneLoadingCompelete()})},t.prototype.onSceneLoadingCompelete=function(){LayerManager.Ins.hideLoadingUILayer()},t.prototype.update=function(){null!=this.curScene&&this.curScene.isInitialed&&this.curScene.update()},t}();__reflect(SceneManager.prototype,"SceneManager");var UserData=function(){function t(){}return t.initialData=function(){var e=t.getObject("L1Data");this.l1Data=new L1Data,e&&this.l1Data.initialByData(e)},t.setObject=function(t,e){egret.localStorage.setItem(t,JSON.stringify(e))},t.getObject=function(t){return JSON.parse(egret.localStorage.getItem(t))},t.removeKey=function(t){egret.localStorage.removeItem(t)},t.clearLocalData=function(){egret.localStorage.clear()},t}();__reflect(UserData.prototype,"UserData");var MainScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new MainUI)},e}(IScene);__reflect(MainScene.prototype,"MainScene");var StartScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){var t=new StartPanel;LayerManager.Ins.uiLayer.addChild(t)},e}(IScene);__reflect(StartScene.prototype,"StartScene");var L1Data=function(){function t(){this.currentMainStoryId=0,this.userUseCharIds=[1,2,3,4],this.userAllCharIds=[1,2,3,4,5,6,7,8]}return Object.defineProperty(t.prototype,"CurMainStoryId",{get:function(){return this.currentMainStoryId},set:function(t){this.currentMainStoryId=t,this.writeData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UserUseCharIds",{get:function(){return this.userUseCharIds},set:function(t){this.userUseCharIds=t,this.writeData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UserAllCharIds",{get:function(){return this.userAllCharIds},enumerable:!0,configurable:!0}),t.prototype.initialByData=function(t){for(var e in t)this[e]=t[e]},t.prototype.writeData=function(){UserData.setObject("L1Data",this)},t}();__reflect(L1Data.prototype,"L1Data");var L1LevelType;!function(t){t[t.MainStory=0]="MainStory"}(L1LevelType||(L1LevelType={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var L1MainScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new L1MainUI)},e}(IScene);__reflect(L1MainScene.prototype,"L1MainScene");var L1NormalBattleScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._resLoad=new ResAsyncLoader,e._players=[],e._enemies=[],e._battleEnd=!1,e._battleStart=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"BattleEnd",{get:function(){return this._battleEnd},set:function(t){if(this._battleEnd=!0,1==t){if(UserData.l1Data.levelType==L1LevelType.MainStory){var e=Object.keys(L1LevelCFGS).length-1,r=UserData.l1Data.CurMainStoryId+1;e>=r&&(UserData.l1Data.CurMainStoryId=r)}this._battleSceneUI.battleEnd()}},enumerable:!0,configurable:!0}),e.prototype.initial=function(){this.skillManager=new L1SkillManager,this.creationManager=new L1CreationManager,this.buffManager=new L1BuffManager,this._battleSceneUI=new L1BattleSceneUI,LayerManager.Ins.uiLayer.addChild(this._battleSceneUI),this.initialGameLayer()},e.prototype.initialGameLayer=function(){for(var t=this,e=this.readEnemiesIds(),r=0,n=e;r<n.length;r++){var i=n[r],a=new L1Char(L1Camp.Enemy,i);a.addToScene(),this._enemies.push(a)}for(var o=UserData.l1Data.UserUseCharIds,s=0,c=o;s<c.length;s++){var i=c[s],a=new L1Char(L1Camp.Player,i);a.addToScene(),this._players.push(a)}this._enemies.sort(function(t,e){return t.rawAttr.posNum-e.rawAttr.posNum}),this._players.sort(function(t,e){return t.rawAttr.posNum-e.rawAttr.posNum}),this._enemies.forEach(function(e){e.initial(t._players,t._enemies)}),this._players.forEach(function(e){e.initial(t._enemies,t._players)})},e.prototype.readEnemiesIds=function(){return UserData.l1Data.levelType==L1LevelType.MainStory?L1LevelCFGS[UserData.l1Data.CurMainStoryId]:void 0},e.prototype.battleStart=function(){this._battleStart=!0},e.prototype.removeChar=function(t){for(var e=-1,r=0;r<this._players.length;r++)if(this._players[r].charId==t){e=r;break}if(-1==e)return void console.warn("哪里不对劲");var n=this._players[e];n.removeFromScene(),this._players.splice(e,1),this.endReplace()},e.prototype.addChar=function(t){var e=new L1Char(L1Camp.Player,t);e.addToScene(),this._players.push(e),this.endReplace()},e.prototype.endReplace=function(){var t=this;this._players.sort(function(t,e){return t.rawAttr.posNum-e.rawAttr.posNum}),this._players.forEach(function(e){e.initial(t._enemies,t._players)})},e.prototype.update=function(){if(this._battleStart&&!this.BattleEnd){var t=0,e=0;if([this._enemies,this._players].forEach(function(r){r.forEach(function(r){r.alive&&(r.camp==L1Camp.Enemy&&e++,r.camp==L1Camp.Player&&t++)})}),0==t)return this.BattleEnd=!0,void ToastInfoManager.newRedToast("战斗失败");if(0==e)return this.BattleEnd=!0,void ToastInfoManager.newRedToast("战斗胜利");this.skillManager.update(),this.creationManager.update(),this.buffManager.update(),[this._enemies,this._players].forEach(function(t){t.forEach(function(t){t.update()})})}},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._resLoad.loadGroup("portrait",0,LayerManager.Ins.loadingUI)];case 1:return t.sent(),[2]}})})},e.prototype.releaseResource=function(){this._resLoad.releaseResource()},e}(IScene);__reflect(L1NormalBattleScene.prototype,"L1NormalBattleScene");var L1RoughlikeScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new L1MainUI)},e}(IScene);__reflect(L1RoughlikeScene.prototype,"L1RoughlikeScene");var VERIFYURL="https://1062258897406555.cn-shanghai.fc.aliyuncs.com/2016-08-15/proxy/python_serve/simple_verify/",L1SKCFGS={TEMPLATE:new L1SkillConfig("",1e3,{0:function(){}},function(t){return null}),NROMATK:new L1SkillConfig("",1e3,{0:function(t){t.caster.startAnim([[0,0],[10,0],[-5,0],[0,0]],[75,100,50]),t.caster.addAngerNumber(15)},75:function(t){L1Harm.harm(t.caster,t.targets)},225:function(){}},function(t){return[t.caster.normalAttakTarget]}),NORMRANGATK:new L1SkillConfig("",1e3,{0:function(t){t.caster.startAnim([[0,0],[10,0],[-5,0],[0,0]],[75,100,50]),t.caster.addAngerNumber(15),t.newCreation(L1CRTNCFGS.NORMBULLET01,t.caster,t.targets[0],t.caster.pos,t.targets[0].pos)},225:function(){}},function(t){return[t.caster.normalAttakTarget]}),HEALSKILL:new L1SkillConfig("风灵颂",1e4,{0:function(t){t.caster.startAnim([[0,0],[0,10],[0,-10],[0,0]],[75,150,75])},150:function(t){L1Harm.harm(t.caster,t.targets,L1HARMCFGS.HEAL01)}},function(t){return[t.caster]}),TEST01:new L1SkillConfig("测试大招",4e4,{0:function(t){t.caster.startAnim([[0,0],[0,20],[0,-20],[0,0],[-20,0],[20,0],[0,0]],[75,150,75,75,150,75])},150:function(t){L1Harm.harm(t.caster,t.targets,L1HARMCFGS.HEAL01)},5e3:function(){}},function(t){return[t.caster]}),TEST02:new L1SkillConfig("测试小技能",2e4,{0:function(t){t.caster.startAnim([[0,0],[0,10],[0,-10],[0,0]],[75,150,75])},150:function(t){}},function(t){return[t.caster]})},CHARCFGS={1:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,100),[L1SKCFGS.HEALSKILL,L1SKCFGS.TEST01,L1SKCFGS.TEST02],L1SKCFGS.NORMRANGATK,[],"测试角色1","1_portrait_png"),2:new L1CharConfig(new L1CharAttr(1e3,200,200,120,10,10,1.2,0),[L1SKCFGS.HEALSKILL,L1SKCFGS.TEST01,L1SKCFGS.TEST02],L1SKCFGS.NROMATK,[],"测试角色2","2_portrait_png"),3:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[L1SKCFGS.HEALSKILL,L1SKCFGS.TEST01,L1SKCFGS.TEST02],L1SKCFGS.NORMRANGATK,[],"测试角色3","3_portrait_png"),4:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[L1SKCFGS.HEALSKILL,L1SKCFGS.TEST01,L1SKCFGS.TEST02],L1SKCFGS.NORMRANGATK,[],"测试角色4","4_portrait_png"),5:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[L1SKCFGS.HEALSKILL,L1SKCFGS.TEST01,L1SKCFGS.TEST02],L1SKCFGS.NORMRANGATK,[],"测试角色5","5_portrait_png"),6:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[L1SKCFGS.HEALSKILL,L1SKCFGS.TEST01,L1SKCFGS.TEST02],L1SKCFGS.NORMRANGATK,[],"测试角色6","6_portrait_png"),7:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[L1SKCFGS.HEALSKILL,L1SKCFGS.TEST01,L1SKCFGS.TEST02],L1SKCFGS.NORMRANGATK,[],"测试角色7","7_portrait_png"),8:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[L1SKCFGS.HEALSKILL,L1SKCFGS.TEST01,L1SKCFGS.TEST02],L1SKCFGS.NORMRANGATK,[],"测试角色8","8_portrait_png")},L1CRTNCFGS={TEMPLATE:new L1CreationConfig(100,L1CrtnFlyType.FIX,L1CrTnAffectContType.ONECE,L1CrTnAffectTargetSetType.PRESET,L1CrtnAffectTargetCamp.OTHER,400,1e3,200,function(t,e){},.9,ColorDef.DarkOrange),NORMBULLET01:new L1CreationConfig(5,L1CrtnFlyType.CHAR,L1CrTnAffectContType.ONECE,L1CrTnAffectTargetSetType.PRESET,L1CrtnAffectTargetCamp.OTHER,800,1,10,function(t,e){L1Harm.harm(e,t)},1,ColorDef.DarkOrange)},L1HARMCFGS={TEMPLATE:new L1HarmConfig(function(t,e){return[!0,0]}),HEAL01:new L1HarmConfig(function(t,e){var r=L1Harm.isRandTrue(t.critPoint),n=.2*t.maxHp;return r&&(n*=t.critTime),[r,-n]})},L1LevelCFGS={0:[1,1],1:[1,1,1],2:[1,1,2,2]},L1Char=function(){function t(t,e){var r=this;this._curAnger=0,this._angerAddFrame=0,this.inSkillCasting=!1,this._destPos=[0,0],this._curSkillIndex=0,this.alive=!0,this.camp=t,this.skillManager=SceneManager.Ins.curScene.skillManager,this.charId=e;var n=CHARCFGS[e];this._charPort=new L1CharPortr(t,n.portImageName,e),this.name=name,this.rawAttr=n.attr,this.skills=n.skills.map(function(t){return L1SkillManager.Ins.newSkill(t,r)}),this.maxHp=this.rawAttr.maxHp,this.curHp=this.maxHp,this._curAnger=0,this.def=this.rawAttr.def,this.atk=this.rawAttr.atk,this.dodgePoint=this.rawAttr.dodgePoint,this.critPoint=this.rawAttr.critPoint,this.critTime=this.rawAttr.critTime,this._angerAddFrame=this.rawAttr.angerAdds/60,this.normalAttackSkill=this.skillManager.newSkill(n.normalSkill,this),this.buffStatus=new MySet,this.buffs=new MySet}return t.prototype.addAngerNumber=function(t){var e=this._curAnger+t;e>L1CharAttr.MAXANGER&&(e=L1CharAttr.MAXANGER),this._curAnger=e,this._charPort.initialed&&this._charPort.drawAngerCircle(e/L1CharAttr.MAXANGER)},Object.defineProperty(t.prototype,"x",{get:function(){return this._charPort.x},set:function(t){this._charPort.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._charPort.y},set:function(t){this._charPort.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return[this.x,this.y]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._charPort.rotationCircle.rotation},set:function(t){this._charPort.rotationCircle.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"moveSpeed",{get:function(){return this.rawAttr.moveSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationSpeed",{get:function(){return this.rawAttr.rotationSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curHp",{get:function(){return this._curHp},set:function(t){this.alive&&(t>this.maxHp&&(t=this.maxHp),0>=t?(this._curHp=0,this.alive=!1,this._charPort.drawHpCircle(0),this.removeFromScene()):(this._curHp=t,this._charPort.initialed&&this._charPort.drawHpCircle(t/this.maxHp)))},enumerable:!0,configurable:!0}),t.prototype.initial=function(t,e){this.oppos=t,this.coops=e;var r=e.indexOf(this),n=this.camp==L1Camp.Player?-1:1;this.x=(130*Math.floor(r/2)+130)*n+GameRoot.GameStage.stageWidth/2,this.y=(r%2*2-1)*(70+100*Math.floor(r/2))+500,this.camp==L1Camp.Enemy&&(this.rotation=180)},t.prototype.update=function(){if(this.alive&&(this.addAngerNumber(this._angerAddFrame),!this.isDizz()&&!this.inSkillCasting&&(null!=this.normalAttakTarget&&this.normalAttakTarget.alive||(this.normalAttakTarget=this.findNormalATKTarget(this.oppos)),null!=this.normalAttakTarget))){var t=this.findATKLocation();if(this._destPos=[Math.ceil(t[0]),Math.ceil(t[1])],!this.isSamePos([this.x,this.y],this._destPos)){this.movingTo(this._destPos);var e=this.getRotationToPos(this._destPos);return e=this.getPropDestRotation(e),void this.rotTo(e)}var r=this.getRotationToPos([this.normalAttakTarget.x,this.normalAttakTarget.y]);if(r=this.getPropDestRotation(r),this.rotTo(r),Util.isNumEqual(this.rotation,r)){if(this._curAnger==L1CharAttr.MAXANGER&&!this.isSlient())for(var n=this._curSkillIndex;;){var i=this.skills[n];if(i.isCoolDown())return this.skillManager.castSkill(i),this.addAngerNumber(-L1CharAttr.MAXANGER),this._curSkillIndex=n+1,void(this._curSkillIndex==this.skills.length&&(this._curSkillIndex=0));if(n+=1,n==this.skills.length&&(n=0),n==this._curSkillIndex)break}this.targetInRange()&&this.normalAttackSkill.isCoolDown()&&this.skillManager.castSkill(this.normalAttackSkill)}}},t.prototype.getRotationToPos=function(t){var e=Util.getRad([this.x,this.y],t);return Math.ceil(Util.degNormalize(90-e/angle2RadParam))},t.prototype.getPropDestRotation=function(t){var e=Math.abs(t-this.rotation),r=Math.abs(t+360-this.rotation),n=Math.abs(t-360-this.rotation);return e>r?t+360:e>n?t-360:t},t.prototype.isSamePos=function(t,e,r){return void 0===r&&(r=6),Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])<=r},t.prototype.movingTo=function(t){var e=Util.getRad([this.x,this.y],t),r=1/GameRoot.GameStage.frameRate,n=r*this.moveSpeed;this.x=Math.ceil(this.x+n*Math.sin(e)),this.y=Math.ceil(this.y+n*Math.cos(e))},t.prototype.startAnim=function(t,e){this._charPort.startAnim(t,e)},t.prototype.rotTo=function(t){if(!Util.isNumEqual(t,this.rotation)){var e=1/GameRoot.GameStage.frameRate,r=e*this.rotationSpeed;return Math.abs(this.rotation-t)<r?void(this.rotation=t):this.rotation>t?void(this.rotation-=r):this.rotation<t?void(this.rotation+=r):void 0}},t.prototype.findNormalATKTarget=function(t){for(var e=Number.MAX_VALUE,r=null,n=0,i=t;n<i.length;n++){var a=i[n];if(a.alive){var o=this.disFrom(a);e>o&&(r=a,e=o)}}return r},t.prototype.disFrom=function(t){return Util.pointDistance([t.x,t.y],[this.x,this.y])},t.prototype.targetInRange=function(){return this.rawAttr.range-this.disFrom(this.normalAttakTarget)>-10},t.prototype.findATKLocation=function(){if((null==this.normalAttakTarget||this.targetInRange())&&this.isPosLegal(this.x,this.y))return[this.x,this.y];var t=this.normalAttakTarget.x,e=this.normalAttakTarget.y,r=0,n=0,i=Util.getRad([t,e],[this.x,this.y]),a=30*angle2RadParam;if(l=this.getLinePosByRad([t,e],i,this.rawAttr.range),r=l[0],n=l[1],this.isPosLegal(r,n))return[r,n];for(var o=i,s=1;12>s;s++)if(o+=a,u=this.getLinePosByRad([t,e],o,this.rawAttr.range),r=u[0],n=u[1],this.isPosLegal(r,n))return[r,n];for(var c=this.rawAttr.range-L1CharAttr.CHARMINDIS/4;c>L1CharAttr.CHARMINDIS;){if(f=this.getLinePosByRad([t,e],i,c),r=f[0],n=f[1],this.isPosLegal(r,n))return[r,n];c-=L1CharAttr.CHARMINDIS/4}c=this.rawAttr.range+L1CharAttr.CHARMINDIS/4;for(var h=this.disFrom(this.normalAttakTarget);h>c;){if(p=this.getLinePosByRad([t,e],i,c),r=p[0],n=p[1],this.isPosLegal(r,n))return[r,n];c+=L1CharAttr.CHARMINDIS/4}return[this.x,this.y];var l,u,f,p},t.prototype.getLinePosByRad=function(t,e,r){var n=t[0]+r*Math.sin(e),i=t[1]+r*Math.cos(e);return[n,i]},t.prototype.isPosLegal=function(t,e){var r=L1CharAttr.CHARMINDIS/2,n=L1CharAttr.CHARMINDIS/2,i=GameRoot.GameStage.stageWidth-L1CharAttr.CHARMINDIS/2,a=GameRoot.GameStage.stageHeight-L1CharAttr.CHARMINDIS/2;if(r>t||n>e||t>i||e>a)return!1;for(var o=0,s=[this.oppos,this.coops];o<s.length;o++)for(var c=s[o],h=0,l=c;h<l.length;h++){var u=l[h];if(u.alive&&u!=this&&Util.pointDistance([t,e],[u.x,u.y])<L1CharAttr.CHARMINDIS&&Util.pointDistance([t,e],u._destPos)<L1CharAttr.CHARMINDIS)return!1}return!0},t.prototype.addToScene=function(){LayerManager.Ins.gameLayer.addChild(this._charPort)},t.prototype.removeFromScene=function(){LayerManager.Ins.gameLayer.removeChild(this._charPort)},t.prototype.endSkillCast=function(){egret.Tween.removeTweens(this._charPort.contentGroup)},Object.defineProperty(t.prototype,"DODGE",{get:function(){return Math.min(L1CharAttr.MAXDODGEP,this.dodgePoint)},enumerable:!0,configurable:!0}),t.prototype.isDizz=function(){return L1BuffStatus.DIZZ in this.buffStatus},t.prototype.isSlient=function(){return L1BuffStatus.SLIENT in this.buffStatus},t.prototype.refreshBuffAttr=function(){for(var t=[],e=0,r=this.buffs.data;e<r.length;e++){var n=r[e],i=n.config.isAffect(this,n.caster);n.config.buffType==L1BuffType.ATTRCHANGE&&i&&t.push(n)}for(var a={},o={},s=0,c=L1CharAttr.ATTRNAMES;s<c.length;s++){var h=c[s];a[h]=0,o[h]=0}for(var l=0,u=t;l<u.length;l++)for(var n=u[l],f=0,p=L1CharAttr.ATTRNAMES;f<p.length;f++){var h=p[f];h in n.config.attrAddAbs&&(a[h]+=n.config.attrAddAbs[h]),h in n.config.attrAddRatio&&(o[h]+=n.config.attrAddRatio[h])}this.atk=this.rawAttr.atk*(1+o[L1ATTRNAME.ATK])+a[L1ATTRNAME.ATK],this.def=this.rawAttr.def*(1+o[L1ATTRNAME.DEF])+a[L1ATTRNAME.DEF],this.critPoint=this.rawAttr.critPoint*(1+o[L1ATTRNAME.CRITP])+a[L1ATTRNAME.CRITP],this.dodgePoint=this.rawAttr.dodgePoint*(1+o[L1ATTRNAME.DODGEP])+a[L1ATTRNAME.DODGEP];var d=this.rawAttr.maxHp*(1+o[L1ATTRNAME.MAXHP])+a[L1ATTRNAME.MAXHP];if(d>this.maxHp){var g=d-this.maxHp;this.curHp+=g,this.maxHp=d}this.critTime=this.rawAttr.critTime*(1+o[L1ATTRNAME.CRITT])+a[L1ATTRNAME.CRITT]},t.prototype.refreshBuffStatus=function(){this.buffStatus.removeAll();for(var t=[],e=0,r=this.buffs.data;e<r.length;e++){var n=r[e],i=n.config.isAffect(this,n.caster);n.config.buffType==L1BuffType.STATUS&&i&&t.push(n.config.status)}for(var a=0,o=t;a<o.length;a++){var s=o[a];this.buffStatus.add(s)}this.isDizz()?this._charPort.toDizz():this._charPort.outDizz(),this.isSlient()?this._charPort.toSlient():this._charPort.outSlient()},t}();__reflect(L1Char.prototype,"L1Char");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,r,n){function i(t){e.call(n,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),r.call(n))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,r){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)
},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var c=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(c,function(r){window.JSONParseClass.setData(r),egret.callLater(function(){e.call(n,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var L2Filters=function(){function t(){}return t.addOutGlowFilter=function(e){t.addFilter(e,t._outerGlowFilter)},t.removeOutGlowFilter=function(e){t.removeFilter(e,t._outerGlowFilter)},t.addGreyFilter=function(e){t.addFilter(e,t._greyColorFlilter)},t.removeGreyFilter=function(e){t.removeFilter(e,t._greyColorFlilter)},t.addYellowGlow=function(e){t.addFilter(e,t._outerGlowYellowFilter)},t.removeYellowGlow=function(e){t.removeFilter(e,t._outerGlowYellowFilter)},t.removeFilter=function(t,e){return t.filters?(Util.removeObjFromArray(t.filters,e)||console.log("object have no such filter"),void(0==t.filters.length&&(t.filters=null))):void console.log("没有发现滤镜，不应该有这个情况噢")},t.addFilter=function(t,e){t.filters?t.filters.push(e):t.filters=[e]},t._outerGlowFilter=new egret.GlowFilter(3394815,1,40,40,2,3,!1,!1),t._outerGlowYellowFilter=new egret.GlowFilter(15658496,1,40,40,2,3,!1,!1),t._greyColorFlilter=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),t}();__reflect(L2Filters.prototype,"L2Filters");var L1CharPortr=function(t){function e(e,r,n){void 0===n&&(n=0);var i=t.call(this)||this;return i._portImage=r,i._charId=n,i._camp=e,i.initialed=!1,i.addEventListener(eui.UIEvent.COMPLETE,i.UIEventEndInit,i),i}return __extends(e,t),e.prototype.UIEventEndInit=function(){this.portImage.source=this._portImage,this.portImage.mask=this.portMask,this._camp==L1Camp.Player?this.hpNumCircle.fillColor=ColorDef.LimeGreen:this.hpNumCircle.fillColor=ColorDef.DarkRed,this.angerNumMask=new egret.Shape,this.contentGroup.addChild(this.angerNumMask),this.angerNumCircle.mask=this.angerNumMask,this.drawAngerCircle(0),this.hpNumMask=new egret.Shape,this.contentGroup.addChild(this.hpNumMask),this.hpNumCircle.mask=this.hpNumMask,this.drawHpCircle(1),this.rotationPoint.fillColor=this._camp==L1Camp.Player?ColorDef.LimeGreen:ColorDef.DarkRed;this.initialed=!0},e.prototype.drawHpCircle=function(t){this.hpNumMask.x=0,this.hpNumMask.y=0,this.drawCircle(this.hpNumMask,360*t,this.hpNumCircle.width/2),this.hpNumMask.x=this.contentGroup.width/2,this.hpNumMask.y=this.contentGroup.width/2},e.prototype.drawAngerCircle=function(t){this.angerNumMask.x=0,this.angerNumMask.y=0,this.drawCircle(this.angerNumMask,360*t,this.angerNumCircle.width/2),this.angerNumMask.x=this.contentGroup.width/2,this.angerNumMask.y=this.contentGroup.width/2},e.prototype.drawCircle=function(t,e,r){var n=-90;e-=90,Util.drawAngleCircle(t,e,r,n)},e.prototype.startAnim=function(t,e){egret.Tween.removeTweens(this.contentGroup);var r=this.rotationCircle.rotation*angle2RadParam,n=t[0],i=this.getAngleCoorSysPos(n,r),a=i[0],o=i[1];this.contentGroup.x=a,this.contentGroup.y=o;for(var s=egret.Tween.get(this.contentGroup),c=0;c<e.length;c++){var h=this.getAngleCoorSysPos(t[c+1],r),l=h[0],u=h[1],f=e[c];s.to({x:l,y:u},f)}},e.prototype.getAngleCoorSysPos=function(t,e){var r=t[0],n=t[1],i=Math.cos(-e),a=Math.sin(-e),o=r*i+n*a,s=n*i-r*a;return[o,s]},e.prototype.toDizz=function(){this.dizzLabel.visible=!0},e.prototype.outDizz=function(){this.dizzLabel.visible=!1},e.prototype.toSlient=function(){this.slientLabel.visible=!0},e.prototype.outSlient=function(){this.slientLabel.visible=!1},e}(eui.Component);__reflect(L1CharPortr.prototype,"L1CharPortr");var L1Camp;!function(t){t[t.Enemy=1]="Enemy",t[t.Player=-1]="Player"}(L1Camp||(L1Camp={}));var L1Buff=function(){function t(){this._activateFrame=0}return t.prototype.initial=function(t,e,r){this.config=t;var n=GameRoot.GameStage.frameRate/1e3;this._periodFrame=Math.ceil(this.config.period*n),this._durationFrame=Math.ceil(this.config.duration*n),this._condPeriodFrame=Math.ceil(this.config.condCd*n),this._preCondAffectFrame=-this._condPeriodFrame,this.addToTarget(e),this._activateFrame=0,this.caster=r},t.prototype.addToTarget=function(t){this._target=t,t.buffs.add(this),this.config.buffType==L1BuffType.STATUS&&t.refreshBuffStatus(),this.config.buffType==L1BuffType.ATTRCHANGE&&t.refreshBuffAttr(),this.showBuffName()},t.prototype.showBuffName=function(){if(""!=this.config.name){var t=ColorDef.GhostWhite,e=25;ToastInfoManager.newToast(this.config.name,t,this._target.y-60,this._target.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,e,!1,egret.Ease.quadOut)}},t.prototype.removeFromTarget=function(){var t=this._target;t.buffs.remove(this),this.config.buffType==L1BuffType.STATUS&&t.refreshBuffStatus(),this.config.buffType==L1BuffType.ATTRCHANGE&&t.refreshBuffAttr()},t.prototype.update=function(){this.config.buffType==L1BuffType.AFFECTPERIOD&&this._activateFrame%this._periodFrame==0&&this.config.isAffect(this._target,this.caster)&&this.config.affectFunc(this._target,this.caster),this.config.buffType==L1BuffType.AFFECTCOND&&this._activateFrame-this._preCondAffectFrame>=this._condPeriodFrame&&this.config.isAffect(this._target,this.caster)&&(this.config.affectFunc(this._target,this.caster),this._preCondAffectFrame=this._activateFrame),this._activateFrame+=1},t.prototype.isLifeEnd=function(){return 0==this._durationFrame?!1:this._activateFrame>this._durationFrame},t}();__reflect(L1Buff.prototype,"L1Buff");var MySet=function(){function t(){this.data=[]}return t.prototype.add=function(t){var e=this.data;return e.indexOf(t)>=0?!1:(e.push(t),!0)},t.prototype.remove=function(t){return Util.removeObjFromArray(this.data,t)},t.prototype.removeAll=function(){this.data=[]},t.prototype.addList=function(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];this.add(n)}},t}();__reflect(MySet.prototype,"MySet");var L1BuffManager=function(){function t(){this._deadBuffs=[],this._activateBuffs=new MySet}return Object.defineProperty(t,"Ins",{get:function(){return SceneManager.Ins.curScene.buffManager},enumerable:!0,configurable:!0}),t.prototype.update=function(){for(var t=[],e=0,r=this._activateBuffs.data;e<r.length;e++){var n=r[e];n.update(),n.isLifeEnd()&&(t.push(n),n.removeFromTarget())}for(var i=0,a=t;i<a.length;i++){var n=a[i];this._activateBuffs.remove(n),this._deadBuffs.push(n)}},t.prototype.newBuff=function(t,e,r){var n=null;n=0==this._deadBuffs.length?new L1Buff:this._deadBuffs.pop(),this._activateBuffs.add(n),n.initial(t,e,r)},t.prototype.removeBuff=function(t){t.removeFromTarget(),this._deadBuffs.push(t),this._activateBuffs.remove(t)},t}();__reflect(L1BuffManager.prototype,"L1BuffManager");var L1Creation=function(){function t(){this._isFly=!0,this._isAffected=!1,this._toDestFrame=Number.MAX_VALUE,this._contentGroup=new eui.Group,this._circleShape=new egret.Shape,this._contentGroup.addChild(this._circleShape)}return Object.defineProperty(t.prototype,"x",{get:function(){return this._contentGroup.x},set:function(t){this._contentGroup.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._contentGroup.y},set:function(t){this._contentGroup.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return[this.x,this.y]},set:function(t){this.x=t[0],this.y=t[1]},enumerable:!0,configurable:!0}),t.prototype.initial=function(t,e,r,n,i,a){void 0===r&&(r=null),void 0===i&&(i=null),void 0===a&&(a=null),LayerManager.Ins.gameLayer.addChild(this._contentGroup),this._caster=e,this._config=t,this._targetChar=r,this._posDest=i,this._directRad=a;var o=GameRoot.GameStage.frameRate/1e3;this._lifeDurationFrame=Math.ceil(this._config.lifeTime*o),this._affectPeriodFrame=Math.ceil(this._config.affectPeriod*o),this._flySpeedFrame=this._config.flySpeed*o,this._activateFrame=0,this._toDestFrame=Number.MAX_VALUE,Util.drawAngleCircle(this._circleShape,360,this._config.radius,0,this._config.color,this._config.alpha),this._circleShape.x=this._circleShape.y=0,this.x=n[0],this.y=n[1],this._isFly=!0,this._isAffected=!1,this._config.flyType==L1CrtnFlyType.FIX&&(this._isFly=!1)},t.prototype.update=function(){this._isFly&&(this._config.flyType==L1CrtnFlyType.CHAR&&this.flyTo(this._targetChar.pos),this._config.flyType==L1CrtnFlyType.POSITION&&this.flyTo(this._posDest),this._config.flyType==L1CrtnFlyType.DIRECT&&this.flyToRad(this._directRad));var t=!1;if(this._config.affectContType==L1CrTnAffectContType.CONTINUE&&this._activateFrame%this._affectPeriodFrame==0&&(t=!0),this._config.affectContType==L1CrTnAffectContType.ONECE&&(this._isFly||0!=this._isAffected||(t=!0)),t){var e=this.findAffectTarget();this._config.affectFunc(e,this._caster),this._isAffected=!0}this._activateFrame+=1},t.prototype.findAffectTarget=function(){var t=[];if(this._config.affectTargetSetType==L1CrTnAffectTargetSetType.PRESET)t.push(this._targetChar);else if(this._config.affectTargetSetType==L1CrTnAffectTargetSetType.RANGE){var e=this._caster.oppos;this._config.affectTargetCamp==L1CrtnAffectTargetCamp.SELF&&(e=this._caster.coops);for(var r=0,n=e;r<n.length;r++){var i=n[r];Util.pointDistance(i.pos,this.pos)<this._config.radius&&t.push(i)}}return t},t.prototype.flyTo=function(t){if(this.closeTo(this.pos,t))return this.pos=t,this._isFly=!1,void(this._toDestFrame=this._activateFrame);var e=Util.getRad(this.pos,t);this.flyToRad(e)},t.prototype.closeTo=function(t,e){return Util.pointDistance(t,e)<this._flySpeedFrame+20},t.prototype.flyToRad=function(t){this.x=Math.ceil(this.x+this._flySpeedFrame*Math.sin(t)),this.y=Math.ceil(this.y+this._flySpeedFrame*Math.cos(t))},t.prototype.lifeEnd=function(){LayerManager.Ins.gameLayer.removeChild(this._contentGroup),this._config=null},t.prototype.isLifeEnd=function(){var t=this._toDestFrame;return(this._config.flyType==L1CrtnFlyType.FIX||this._config.flyType==L1CrtnFlyType.DIRECT)&&(t=0),this._activateFrame>this._lifeDurationFrame+t+1},t}();__reflect(L1Creation.prototype,"L1Creation");var ResAsyncLoader=function(){function t(){this._loadResouceLs=new MySet}return t.prototype.getResAsync=function(t,e,r){return this._loadResouceLs.add(t),null==e?RES.getResAsync(t):RES.getResAsync(t,e,r)},t.prototype.loadGroup=function(t,e,r){return this._loadResouceLs.add(t),RES.loadGroup(t,e,r)},t.prototype.getResAsyncAndSetValue=function(t,e,r){this.getResAsync(t,function(){r[e]=RES.getRes(t)},r)},t.prototype.releaseResource=function(){for(var t=0,e=this._loadResouceLs.data;t<e.length;t++){var r=e[t];RES.destroyRes(r)||console.warn("RES `"+r+"` destroy failed.")}},t}();__reflect(ResAsyncLoader.prototype,"ResAsyncLoader");var L1CreationManager=function(){function t(){this._deadCreations=[],this._activateCreations=new MySet}return Object.defineProperty(t,"Ins",{get:function(){return SceneManager.Ins.curScene.creationManager},enumerable:!0,configurable:!0}),t.prototype.update=function(){for(var t=[],e=0,r=this._activateCreations.data;e<r.length;e++){var n=r[e];n.update(),n.isLifeEnd()&&(n.lifeEnd(),t.push(n))}for(var i=0,a=t;i<a.length;i++){var n=a[i];this._activateCreations.remove(n),this._deadCreations.push(n)}},t.prototype.newCreation=function(t,e,r,n,i,a){void 0===r&&(r=null),void 0===i&&(i=null),void 0===a&&(a=null);var o=null;o=this._deadCreations.length>0?this._deadCreations.pop():new L1Creation,o.initial(t,e,r,n,i,a),this._activateCreations.add(o)},t}();__reflect(L1CreationManager.prototype,"L1CreationManager");var L1Harm=function(){function t(){}return t.harm=function(t,e,r){var n=new L1HarmConfig;r||(r=n);for(var i=0,a=e;i<a.length;i++){var o=a[i],s=r.harmFunc(t,o),c=s[0],h=s[1];o.curHp-=h,h>=0&&o.addAngerNumber(10),this.harmFloat(o,h,c)}},t.harmFloat=function(t,e,r){if(t.alive){var n="",i="miss",a=25,o=ColorDef.GhostWhite;if(e=Math.ceil(e),0!=e){a=r?30:25;var s=0>e;i=r?"暴击 ":s?"治疗 ":"",o=s?ColorDef.LimeGreen:r?ColorDef.DarkRed:ColorDef.GhostWhite,n=""+(s?"+":"")+-e}ToastInfoManager.newToast(""+i+n,o,t.y-40,t.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,a,!1,egret.Ease.quadOut)}},t.isRandTrue=function(t){return 100*Math.random()<t},t}();__reflect(L1Harm.prototype,"L1Harm");var ToastInfoManager=function(){function t(){}return t.newToast=function(t,e,r,n,i,a,o,s,c,h){var l=this;void 0===e&&(e=ColorDef.DodgerBlue),void 0===r&&(r=60),void 0===n&&(n=0),void 0===i&&(i=-100),void 0===a&&(a=0),void 0===o&&(o=6e3),void 0===s&&(s=30),void 0===c&&(c=!0),void 0===h&&(h=egret.Ease.circOut);var u;u=this._labelPools.length>0?this._labelPools.pop():new eui.Label,u.textColor=e,u.horizontalCenter=n,u.y=r,u.alpha=1,u.size=s,u.text=t,u.bold=c,LayerManager.Ins.uiLayer.addChild(u),egret.Tween.get(u).to({y:u.y+i,horizontalCenter:u.horizontalCenter+a,alpha:0},o,h).call(function(){LayerManager.Ins.uiLayer.removeChild(u),l._labelPools.push(u)})},t.newRedToast=function(e){t.newToast(e,ColorDef.Coral)},t._labelPools=[],t}();__reflect(ToastInfoManager.prototype,"ToastInfoManager");var L1Skill=function(){function t(){this._castframeCount=0,this._creationManager=SceneManager.Ins.curScene.creationManager,this._buffManager=SceneManager.Ins.curScene.buffManager}return t.prototype.initial=function(t,e){this.caster=t,this.config=e;var r=GameRoot.GameStage.frameRate/1e3;this._frameCD=Math.ceil(this.config.cdMs*r);var n=this.config.timeLine,i={};for(var a in n)i[Math.ceil(parseInt(a)*r)]=n[a];this._endFrame=0;for(var a in i){var o=parseInt(a);o>this._endFrame&&(this._endFrame=o)}this._endFrame+=1,this.timeLine=i,this._runCd=0},t.prototype.release=function(){},Object.defineProperty(t.prototype,"CDRUN",{get:function(){return this._runCd},set:function(t){0>=t&&(t=0),this._runCd=t},enumerable:!0,configurable:!0}),t.prototype.isCoolDown=function(){return 0==this.CDRUN},t.prototype.findTarget=function(){this.targets=this.config.skillTargetFind(this)},t.prototype.castPrepare=function(){this._castframeCount=0,this.CDRUN=this._frameCD,this.showSkillName(),this.caster.inSkillCasting=!0},t.prototype.showSkillName=function(){if(""!=this.config.name){var t=ColorDef.DodgerBlue,e=40;ToastInfoManager.newToast(this.config.name,t,this.caster.y-60,this.caster.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,e,!0,egret.Ease.quadOut)}},t.prototype.isCD=function(){return 0==this.CDRUN},t.prototype.isEnd=function(){return this._castframeCount>this._endFrame},t.prototype.castingUpdate=function(){this._castframeCount in this.timeLine&&this.timeLine[this._castframeCount](this),this._castframeCount+=1},t.prototype.endCast=function(){this.caster.inSkillCasting=!1,this.caster.endSkillCast()},t.prototype.newCreation=function(t,e,r,n,i,a){void 0===r&&(r=null),void 0===i&&(i=null),void 0===a&&(a=null),this._creationManager.newCreation(t,e,r,n,i,a)},t.prototype.newBuff=function(t,e,r){this._buffManager.newBuff(t,e,r)},t}();__reflect(L1Skill.prototype,"L1Skill");var Util=function(){function t(){}return t.removeObjFromArray=function(t,e){var r=t.indexOf(e);return r>=0?(t.splice(r,1),!0):!1},t.createColorBG=function(t,e,r,n){void 0===r&&(r=ColorDef.DimGray),void 0===n&&(n=1);var i=new egret.Shape;return i.width=t,i.height=e,i.graphics.beginFill(r,n),i.graphics.drawRect(0,0,t,e),i.graphics.endFill(),i},t.safeRemoveFromParent=function(t){if(t){var e=t.parent;e&&e.removeChild(t)}},t.getRandomArray=function(t){for(var e=[],r=t.length;r>0;){var n=Math.floor(Math.random()*r);n==r&&(n-=1),e.push(t.splice(n,1)[0]),r-=1}return e},t.largeSmallTweenAnim=function(t,e,r,n){var i=t.x,a=t.y,o=t.width,s=t.height,c=o*e,h=s*r,l=i-(c-o)/2,u=a-(h-s)/2;egret.Tween.get(t,{loop:!0}).to({width:c,height:h,x:l,y:u},n).to({width:o,height:s,x:i,y:a},n)},t.httpGet=function(t,e,r,n,i){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(t,egret.HttpMethod.GET),a.send(),a.addEventListener(egret.Event.COMPLETE,e,i),a.addEventListener(egret.IOErrorEvent.IO_ERROR,r,i),a.addEventListener(egret.ProgressEvent.PROGRESS,n,i)},t.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},t.drawAngleCircle=function(t,e,r,n,i,a){void 0===n&&(n=0),void 0===i&&(i=ColorDef.DarkRed),void 0===a&&(a=1),t.graphics.clear(),t.graphics.beginFill(i,a),t.graphics.moveTo(0,0);var o=n*angle2RadParam,s=Math.cos(o)*r,c=Math.sin(o)*r;t.graphics.lineTo(s,c),t.graphics.drawArc(0,0,r,o,e*Math.PI/180),t.graphics.lineTo(0,0),t.graphics.endFill()},t.pointDistance=function(t,e){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)},t.getRad=function(e,r){var n=t.pointDistance(e,r),i=r[1]-e[1],a=r[0]-e[0],o=a/n,s=Math.acos(i/n);return o>0?s:-s},t.isNumEqual=function(t,e,r){return void 0===r&&(r=3),Math.abs(t-e)<r},t.degNormalize=function(t){return t%=360,t>180?t-360:-180>t?t+360:t},t}();__reflect(Util.prototype,"Util");var angle2RadParam=Math.PI/180,L1SkillManager=function(){function t(){this._skillCastingList=new MySet,this._allSkillList=new MySet}return Object.defineProperty(t,"Ins",{get:function(){return SceneManager.Ins.curScene.skillManager},enumerable:!0,configurable:!0}),t.prototype.update=function(){for(var t=[],e=0,r=this._skillCastingList.data;e<r.length;e++){var n=r[e];n.castingUpdate(),n.isEnd()&&(n.endCast(),t.push(n))}for(var i=0,a=t;i<a.length;i++){var n=a[i];this._skillCastingList.remove(n)}for(var o=0,s=this._allSkillList.data;o<s.length;o++){var n=s[o];n.CDRUN=n.CDRUN-1}},t.prototype.castSkill=function(t){t.castPrepare(),t.findTarget(),this._skillCastingList.add(t)},t.prototype.castSkillBreak=function(t){t.endCast(),this._skillCastingList.remove(t)},t.prototype.newSkill=function(t,e){var r=new L1Skill;return r.initial(e,t),this._allSkillList.add(r),r},t}();__reflect(L1SkillManager.prototype,"L1SkillManager");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e._progressLabel=new eui.Label,e._progressLabel.horizontalCenter=0,e._progressLabel.verticalCenter=0,e._progressLabel.textColor=ColorDef.Coral,e.addChild(e._progressLabel),e}return __extends(e,t),e.prototype.initial=function(){var t=Util.createColorBG(GameRoot.GameStage.stageWidth,GameRoot.GameStage.stageHeight);this.addChildAt(t,0)},e.prototype.clear=function(){this._progressLabel.text="Loading..."},e.prototype.onProgress=function(t,e){this._progressLabel.text="Loading..."+t+"/"+e},e}(eui.UILayer);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var MainUI=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.GameStage.stageWidth,e.height=GameRoot.GameStage.stageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.mainUIEventInit,e),e}return __extends(e,t),e.prototype.mainUIEventInit=function(){this.l1StartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tol1,this),this.l2StartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tol2,this)},e.prototype.tol1=function(){SceneManager.Ins.setScene(new L1MainScene)},e.prototype.tol2=function(){ToastInfoManager.newRedToast("敬请期待")},e}(eui.Component);__reflect(MainUI.prototype,"MainUI");var StartPanel=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.GameStage.stageWidth,e.height=GameRoot.GameStage.stageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.panelEventInit,e),e}return __extends(e,t),e.prototype.panelEventInit=function(){this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmPswd,this),this.clearLocalButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){UserData.clearLocalData()},this)},e.prototype.debugTap=function(){},e.prototype.confirmPswd=function(t){return 0==this.pswdTextInput.text.length?void alert("验证失败"):(this.confirmButton.enabled=!1,void Util.httpGet(VERIFYURL+this.pswdTextInput.text.substring(0,10),this.onGetComplete,this.onGetIOError,this.onGetProgress,this))},e.prototype.onGetComplete=function(t){var e=t.currentTarget,r=e.response.substring(0,1);return"y"!=r?(alert("验证失败"),void(this.confirmButton.enabled=!0)):(ToastInfoManager.newRedToast("验证成功"),void setTimeout(function(){SceneManager.Ins.setScene(new MainScene)},1e3))},e.prototype.onGetIOError=function(t){alert("网络错误"),this.confirmButton.enabled=!0},e.prototype.onGetProgress=function(t){},e}(eui.Component);__reflect(StartPanel.prototype,"StartPanel");var L1BattleSceneUI=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.GameStage.stageWidth,e.height=GameRoot.GameStage.stageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e._selectIds=[],e}return __extends(e,t),e.prototype.battleEnd=function(){this.nextLevelButton.visible=!0},e.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToL1MainScene,this),this.battleStartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.battleStart,this),this.nextLevelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toNextLevel,this),MessageManager.Ins.addEventListener(MessageType.L1BATTLEUIPORTTAP,this.portTap,this);for(var t=0;t<UserData.l1Data.UserAllCharIds.length;t++){var e=UserData.l1Data.UserAllCharIds[t],r=new L1BattleUIPort(e);r.x=90*t,this.portImageGroup.addChild(r),UserData.l1Data.UserUseCharIds.indexOf(e)>=0&&(r.select(),this._selectIds.push(r.charId))}},e.prototype.toNextLevel=function(){SceneManager.Ins.setScene(new L1NormalBattleScene)},e.prototype.portTap=function(t){var e=t.messageContent,r=e.charId,n=SceneManager.Ins.curScene;return e.IsSelect?(e.selectCancle(),Util.removeObjFromArray(this._selectIds,e.charId),void n.removeChar(r)):4==this._selectIds.length?void ToastInfoManager.newRedToast("已满员"):(e.select(),this._selectIds.push(e.charId),void n.addChar(r))},e.prototype.backToL1MainScene=function(){SceneManager.Ins.setScene(new L1MainScene)},e.prototype.battleStart=function(){return 0==this._selectIds.length?void ToastInfoManager.newRedToast("无上场成员"):(UserData.l1Data.UserUseCharIds=this._selectIds,this.battleStartButton.visible=!1,SceneManager.Ins.curScene.battleStart(),void(this.portScroller.visible=!1))},e}(eui.Component);__reflect(L1BattleSceneUI.prototype,"L1BattleSceneUI");var L1BattleUIPort=function(t){function e(e){var r=t.call(this)||this;r.charId=e;var n=CHARCFGS[e],i=n.portImageName,a=new eui.Image(i);a.width=120,a.height=120;var o=new eui.Rect(80,80);o.ellipseHeight=80,o.ellipseWidth=80,o.y=20,o.x=20,a.mask=o;var s=new eui.Rect(80,80);s.ellipseHeight=80,s.ellipseWidth=80,s.y=20,s.x=20,r._selectMask=s,s.fillColor=ColorDef.DimGray,s.alpha=.5;var c=new eui.Label;return c.text="上场",c.y=50,c.x=30,r._selectLable=c,r.addChild(a),r.addChild(o),r.addChild(s),r.addChild(c),r.selectCancle(),r.addEventListener(egret.TouchEvent.TOUCH_TAP,r.touchTap,r),r}return __extends(e,t),Object.defineProperty(e.prototype,"IsSelect",{get:function(){return this._isSelect},enumerable:!0,configurable:!0}),e.prototype.touchTap=function(){MessageManager.Ins.sendMessage(MessageType.L1BATTLEUIPORTTAP,this)},e.prototype.select=function(){this._isSelect=!0,this._selectMask.visible=!0,this._selectLable.visible=!0},e.prototype.selectCancle=function(){this._isSelect=!1,this._selectMask.visible=!1,this._selectLable.visible=!1},e}(eui.Group);__reflect(L1BattleUIPort.prototype,"L1BattleUIPort");var L1MainUI=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.GameStage.stageWidth,e.height=GameRoot.GameStage.stageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e}return __extends(e,t),e.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToMainScene,this),this.mainStoryButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toL1BattleScene,this),this.roughlikeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toL1RoughlikeScene,this)},e.prototype.backToMainScene=function(){SceneManager.Ins.setScene(new MainScene)},e.prototype.toL1BattleScene=function(){UserData.l1Data.levelType=L1LevelType.MainStory,SceneManager.Ins.setScene(new L1NormalBattleScene)},e.prototype.toL1RoughlikeScene=function(){ToastInfoManager.newRedToast("敬请期待")},e}(eui.Component);__reflect(L1MainUI.prototype,"L1MainUI");